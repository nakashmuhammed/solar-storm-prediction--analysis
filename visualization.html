<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Storm Prediction System - Data Visualization</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 800px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close-btn:hover,
        .close-btn:focus {
            color: #000;
            text-decoration: none;
        }
        
        /* Enhanced visualization controls */
        .visualization-controls {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }
        
        .visualization-controls .form-group {
            flex: 1;
            min-width: 200px;
            margin-bottom: 0;
        }
        
        .visualization-controls label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .visualization-controls select,
        .visualization-controls input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            transition: border-color 0.3s;
        }
        
        .visualization-controls select:focus,
        .visualization-controls input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        .visualization-controls button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
        }
        
        .visualization-controls button:hover {
            background-color: var(--primary-dark);
        }
        
        .visualization-controls button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .chart-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            min-height: 400px;
        }
        
        .chart-description {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 30px;
        }
        
        #customDateRange {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        #customDateRange label {
            width: 100%;
        }
        
        #customDateRange input {
            flex: 1;
            min-width: 150px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="dashboard.html" class="logo">Solar<span>Storm</span>Prediction</a>
                <ul class="nav-links">
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="prediction.html">Prediction</a></li>
                    <li><a href="visualization.html" class="active">Visualization</a></li>
                    <li><a href="historical.html">Historical Data</a></li>
                    <li><a href="profile.html">Profile</a></li>
                    <li><a href="#" id="logoutBtn">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <section class="data-visualization">
                <div class="dashboard-header">
                    <h2>Solar Data Visualization</h2>
                    <p>Explore and visualize solar data with interactive charts and graphs.</p>
                </div>

                <div class="visualization-controls">
                    <div class="form-group">
                        <label for="datasetSelect">Select Dataset</label>
                        <select id="datasetSelect" class="form-control">
                            <option value="dst">DST Index</option>
                            <option value="magnetic">Magnetic Field Components</option>
                            <option value="solar_wind">Solar Wind Parameters</option>
                            <option value="sunspots">Sunspot Activity</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="timeRangeSelect">Time Range</label>
                        <select id="timeRangeSelect" class="form-control">
                            <option value="day">Last 24 Hours</option>
                            <option value="week">Last Week</option>
                            <option value="month">Last Month</option>
                            <option value="year">Last Year</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <div class="form-group" id="customDateRange" style="display: none;">
                        <label for="startDate">Start Date</label>
                        <input type="date" id="startDate" class="form-control">
                        <label for="endDate">End Date</label>
                        <input type="date" id="endDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <button id="updateChartBtn" class="btn">Update Chart</button>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="dataChart"></canvas>
                </div>

                <div class="chart-description" id="chartDescription">
                    <h3>Chart Description</h3>
                    <p>Select a dataset and time range to view the visualization.</p>
                </div>

                <div class="additional-charts">
                    <h3>Additional Visualizations</h3>
                    <div class="card-container">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Correlation Analysis</h3>
                            </div>
                            <div class="card-body">
                                <p>Explore correlations between different solar parameters.</p>
                            </div>
                            <div class="card-footer">
                                <button class="btn" id="correlationBtn">View Correlation</button>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Storm Distribution</h3>
                            </div>
                            <div class="card-body">
                                <p>View the distribution of solar storm intensities over time.</p>
                            </div>
                            <div class="card-footer">
                                <button class="btn" id="distributionBtn">View Distribution</button>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Satellite Position</h3>
                            </div>
                            <div class="card-body">
                                <p>Visualize satellite positions during solar events.</p>
                            </div>
                            <div class="card-footer">
                                <button class="btn" id="satelliteBtn">View Positions</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About Us</h3>
                    <p>The Solar Storm Prediction System is designed to predict solar storm events using machine learning algorithms and historical solar data.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="prediction.html">Prediction</a></li>
                        <li><a href="visualization.html">Visualization</a></li>
                        <li><a href="historical.html">Historical Data</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <p><i class="fas fa-map-marker-alt"></i> 123 Solar Street, Space City</p>
                    <p><i class="fas fa-phone"></i> +1 234 567 8900</p>
                    <p><i class="fas fa-envelope"></i> info@solarstorm.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Solar Storm Prediction System. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>

        // Show/hide custom date range based on selection
        document.getElementById('timeRangeSelect').addEventListener('change', function() {
            const customDateRange = document.getElementById('customDateRange');
            if (this.value === 'custom') {
                customDateRange.style.display = 'block';
                
                // Set default date range if not already set
                const startDate = document.getElementById('startDate');
                const endDate = document.getElementById('endDate');
                
                if (!startDate.value) {
                    // Set default start date to 30 days ago
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    startDate.value = thirtyDaysAgo.toISOString().split('T')[0];
                }
                
                if (!endDate.value) {
                    // Set default end date to today
                    const today = new Date();
                    endDate.value = today.toISOString().split('T')[0];
                }
            } else {
                customDateRange.style.display = 'none';
            }
            
            // Update the chart when time range changes
            updateChart();
        });

        // Initialize chart
        let dataChart;
        
        // Sample data for demonstration with different time ranges
        const sampleData = {
            dst: {
                description: 'The Disturbance Storm Time (DST) index is a measure of geomagnetic activity used to assess the severity of magnetic storms. Negative values indicate a more intense storm.',
                timeRanges: {
                    day: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'DST Index',
                            data: [-7, -10, -10, -6, -2, 0, 2, 5, 3, 0, -3, -5, -8, -12, -15, -18, -20, -25, -30, -28, -25, -20, -15, -10],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    week: {
                        labels: Array.from({length: 7}, (_, i) => ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][i]),
                        datasets: [{
                            label: 'DST Index (Daily Average)',
                            data: [-15, -12, -8, -5, -10, -22, -18],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    month: {
                        labels: Array.from({length: 30}, (_, i) => `${i+1}`),
                        datasets: [{
                            label: 'DST Index (Daily Average)',
                            data: [-5, -8, -10, -12, -15, -18, -20, -22, -25, -28, -30, -25, -20, -15, -10, -5, -2, 0, -3, -5, -8, -10, -15, -20, -25, -30, -28, -25, -20, -15],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    year: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [{
                            label: 'DST Index (Monthly Average)',
                            data: [-12, -15, -18, -20, -22, -25, -28, -30, -25, -20, -15, -10],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            tension: 0.4
                        }]
                    }
                }
            },
            magnetic: {
                description: 'The magnetic field components (Bx, By, Bz) in GSE coordinates represent the interplanetary magnetic field. The Bz component is particularly important for geomagnetic storm prediction.',
                timeRanges: {
                    day: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [
                            {
                                label: 'Bx GSE',
                                data: [-5.55, -5.58, -5.60, -5.62, -5.65, -5.70, -5.75, -5.80, -5.85, -5.90, -5.95, -6.00, -6.05, -6.10, -6.15, -6.20, -6.25, -6.30, -6.35, -6.40, -6.45, -6.50, -6.55, -6.60],
                                borderColor: 'rgba(54, 162, 235, 1)',
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                tension: 0.4
                            },
                            {
                                label: 'By GSE',
                                data: [3.00, 3.16, 3.20, 3.25, 3.30, 3.35, 3.40, 3.45, 3.50, 3.55, 3.60, 3.65, 3.70, 3.75, 3.80, 3.85, 3.90, 3.95, 4.00, 4.05, 4.10, 4.15, 4.20, 4.25],
                                borderColor: 'rgba(255, 206, 86, 1)',
                                backgroundColor: 'rgba(255, 206, 86, 0.2)',
                                tension: 0.4
                            },
                            {
                                label: 'Bz GSE',
                                data: [1.25, 1.17, 1.10, 1.05, 1.00, 0.95, 0.90, 0.85, 0.80, 0.75, 0.70, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40, 0.35, 0.30, 0.25, 0.20, 0.15, 0.10, 0.05],
                                borderColor: 'rgba(75, 192, 192, 1)',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                tension: 0.4
                            }
                        ]
                    },
                    week: {
                        labels: Array.from({length: 7}, (_, i) => ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][i]),
                        datasets: [
                            {
                                label: 'Bx GSE (Daily Average)',
                                data: [-5.75, -5.85, -5.95, -6.05, -6.15, -6.25, -6.35],
                                borderColor: 'rgba(54, 162, 235, 1)',
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                tension: 0.4
                            },
                            {
                                label: 'By GSE (Daily Average)',
                                data: [3.20, 3.35, 3.50, 3.65, 3.80, 3.95, 4.10],
                                borderColor: 'rgba(255, 206, 86, 1)',
                                backgroundColor: 'rgba(255, 206, 86, 0.2)',
                                tension: 0.4
                            },
                            {
                                label: 'Bz GSE (Daily Average)',
                                data: [1.10, 0.95, 0.80, 0.65, 0.50, 0.35, 0.20],
                                borderColor: 'rgba(75, 192, 192, 1)',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                tension: 0.4
                            }
                        ]
                    },
                    month: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [
                            {
                                label: 'Bx GSE (Weekly Average)',
                                data: [-5.80, -6.00, -6.20, -6.40],
                                borderColor: 'rgba(54, 162, 235, 1)',
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                tension: 0.4
                            },
                            {
                                label: 'By GSE (Weekly Average)',
                                data: [3.30, 3.60, 3.90, 4.20],
                                borderColor: 'rgba(255, 206, 86, 1)',
                                backgroundColor: 'rgba(255, 206, 86, 0.2)',
                                tension: 0.4
                            },
                            {
                                label: 'Bz GSE (Weekly Average)',
                                data: [1.00, 0.70, 0.40, 0.10],
                                borderColor: 'rgba(75, 192, 192, 1)',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                tension: 0.4
                            }
                        ]
                    },
                    year: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [
                            {
                                label: 'Bx GSE (Monthly Average)',
                                data: [-5.60, -5.70, -5.80, -5.90, -6.00, -6.10, -6.20, -6.30, -6.40, -6.50, -6.60, -6.70],
                                borderColor: 'rgba(54, 162, 235, 1)',
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                tension: 0.4
                            },
                            {
                                label: 'By GSE (Monthly Average)',
                                data: [3.10, 3.20, 3.30, 3.40, 3.50, 3.60, 3.70, 3.80, 3.90, 4.00, 4.10, 4.20],
                                borderColor: 'rgba(255, 206, 86, 1)',
                                backgroundColor: 'rgba(255, 206, 86, 0.2)',
                                tension: 0.4
                            },
                            {
                                label: 'Bz GSE (Monthly Average)',
                                data: [1.20, 1.10, 1.00, 0.90, 0.80, 0.70, 0.60, 0.50, 0.40, 0.30, 0.20, 0.10],
                                borderColor: 'rgba(75, 192, 192, 1)',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                tension: 0.4
                            }
                        ]
                    }
                }
            },
            solar_wind: {
                description: 'Solar wind parameters include the speed and density of the plasma ejected from the sun. Higher speeds and densities can indicate potential geomagnetic disturbances.',
                timeRanges: {
                    day: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [
                            {
                                label: 'Solar Wind Speed (km/s)',
                                data: [383.92, 381.79, 380.50, 385.20, 390.30, 395.40, 400.50, 405.60, 410.70, 415.80, 420.90, 426.00, 431.10, 436.20, 441.30, 446.40, 451.50, 456.60, 461.70, 466.80, 471.90, 477.00, 482.10, 487.20],
                                borderColor: 'rgba(153, 102, 255, 1)',
                                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                                yAxisID: 'y',
                                tension: 0.4
                            },
                            {
                                label: 'Density (n/cc)',
                                data: [1.53, 1.69, 1.75, 1.80, 1.85, 1.90, 1.95, 2.00, 2.05, 2.10, 2.15, 2.20, 2.25, 2.30, 2.35, 2.40, 2.45, 2.50, 2.55, 2.60, 2.65, 2.70, 2.75, 2.80],
                                borderColor: 'rgba(255, 159, 64, 1)',
                                backgroundColor: 'rgba(255, 159, 64, 0.2)',
                                yAxisID: 'y1',
                                tension: 0.4
                            }
                        ]
                    },
                    week: {
                        labels: Array.from({length: 7}, (_, i) => ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][i]),
                        datasets: [
                            {
                                label: 'Solar Wind Speed (km/s)',
                                data: [390, 410, 430, 450, 470, 490, 510],
                                borderColor: 'rgba(153, 102, 255, 1)',
                                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                                yAxisID: 'y',
                                tension: 0.4
                            },
                            {
                                label: 'Density (n/cc)',
                                data: [1.7, 1.9, 2.1, 2.3, 2.5, 2.7, 2.9],
                                borderColor: 'rgba(255, 159, 64, 1)',
                                backgroundColor: 'rgba(255, 159, 64, 0.2)',
                                yAxisID: 'y1',
                                tension: 0.4
                            }
                        ]
                    },
                    month: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [
                            {
                                label: 'Solar Wind Speed (km/s)',
                                data: [420, 450, 480, 510],
                                borderColor: 'rgba(153, 102, 255, 1)',
                                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                                yAxisID: 'y',
                                tension: 0.4
                            },
                            {
                                label: 'Density (n/cc)',
                                data: [2.0, 2.3, 2.6, 2.9],
                                borderColor: 'rgba(255, 159, 64, 1)',
                                backgroundColor: 'rgba(255, 159, 64, 0.2)',
                                yAxisID: 'y1',
                                tension: 0.4
                            }
                        ]
                    },
                    year: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [
                            {
                                label: 'Solar Wind Speed (km/s)',
                                data: [380, 400, 420, 440, 460, 480, 500, 520, 540, 560, 580, 600],
                                borderColor: 'rgba(153, 102, 255, 1)',
                                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                                yAxisID: 'y',
                                tension: 0.4
                            },
                            {
                                label: 'Density (n/cc)',
                                data: [1.5, 1.7, 1.9, 2.1, 2.3, 2.5, 2.7, 2.9, 3.1, 3.3, 3.5, 3.7],
                                borderColor: 'rgba(255, 159, 64, 1)',
                                backgroundColor: 'rgba(255, 159, 64, 0.2)',
                                yAxisID: 'y1',
                                tension: 0.4
                            }
                        ]
                    }
                }
            },
            sunspots: {
                description: 'Sunspot numbers are an indicator of solar activity. Higher sunspot numbers generally correlate with increased solar activity and potential for solar storms.',
                timeRanges: {
                    day: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'Sunspot Number (Hourly)',
                            data: [75, 75, 76, 76, 77, 77, 78, 78, 79, 79, 80, 80, 81, 81, 82, 82, 83, 83, 84, 84, 85, 85, 86, 86],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    week: {
                        labels: Array.from({length: 7}, (_, i) => ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][i]),
                        datasets: [{
                            label: 'Sunspot Number (Daily)',
                            data: [78, 80, 82, 84, 86, 88, 90],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    month: {
                        labels: Array.from({length: 30}, (_, i) => `${i+1}`),
                        datasets: [{
                            label: 'Sunspot Number (Daily)',
                            data: [75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    year: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [{
                            label: 'Sunspot Number (Monthly Average)',
                            data: [35, 42, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            tension: 0.4
                        }]
                    }
                }
            }
        };

        // Function to update the chart
        function updateChart() {
            const datasetType = document.getElementById('datasetSelect').value;
            const timeRange = document.getElementById('timeRangeSelect').value;
            
            // Get the data for the selected dataset and time range
            const datasetInfo = sampleData[datasetType];
            
            // Handle custom date range
            let chartData;
            if (timeRange === 'custom') {
                // For custom range, we'll use the month data as a placeholder
                // In a real application, this would fetch data for the specific date range
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                
                if (startDate && endDate) {
                    chartData = JSON.parse(JSON.stringify(datasetInfo.timeRanges.month));
                    // Update the chart title to reflect the custom date range
                    const formattedStartDate = new Date(startDate).toLocaleDateString();
                    const formattedEndDate = new Date(endDate).toLocaleDateString();
                    chartData.customTitle = `${formattedStartDate} to ${formattedEndDate}`;
                } else {
                    // If dates aren't selected, default to month view
                    chartData = datasetInfo.timeRanges.month;
                }
            } else {
                // Use the selected time range
                chartData = datasetInfo.timeRanges[timeRange];
            }
            
            // Update the chart description
            document.getElementById('chartDescription').innerHTML = `
                <h3>Chart Description</h3>
                <p>${datasetInfo.description}</p>
            `;
            
            // Destroy existing chart if it exists
            if (dataChart) {
                dataChart.destroy();
            }
            
            // Create chart configuration
            const config = {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: `${datasetType === 'dst' ? 'DST Index' : 
                                   datasetType === 'magnetic' ? 'Magnetic Field Components' : 
                                   datasetType === 'solar_wind' ? 'Solar Wind Parameters' : 
                                   'Sunspot Activity'} - ${timeRange === 'day' ? 'Last 24 Hours' : 
                                                          timeRange === 'week' ? 'Last Week' : 
                                                          timeRange === 'month' ? 'Last Month' : 
                                                          timeRange === 'year' ? 'Last Year' : 
                                                          chartData.customTitle ? chartData.customTitle : 'Custom Range'}`
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: timeRange === 'day' ? 'Hour' : 
                                      timeRange === 'week' ? 'Day' : 
                                      timeRange === 'month' ? (datasetType === 'magnetic' || datasetType === 'solar_wind' ? 'Week' : 'Day') : 
                                      'Month'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: datasetType === 'dst' ? 'DST Index (nT)' : 
                                      datasetType === 'magnetic' ? 'Magnetic Field (nT)' : 
                                      datasetType === 'solar_wind' ? 'Speed (km/s)' : 
                                      'Sunspot Number'
                            }
                        }
                    }
                }
            };
            
            // Add second y-axis for solar wind data
            if (datasetType === 'solar_wind') {
                config.options.scales.y1 = {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'Density (n/cc)'
                    },
                    grid: {
                        drawOnChartArea: false
                    }
                };
            }
            
            // Create the chart
            const ctx = document.getElementById('dataChart').getContext('2d');
            dataChart = new Chart(ctx, config);
        }
        
        // Initialize the chart on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateChart();
        });
        
        // Update chart when button is clicked
        document.getElementById('updateChartBtn').addEventListener('click', function() {
            // Show loading indicator
            const button = this;
            const originalText = button.textContent;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
            button.disabled = true;
            
            // Short timeout to allow UI to update before potentially heavy chart rendering
            setTimeout(function() {
                updateChart();
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
            }, 300);
        });
        
        // Sample correlation data for demonstration
        const correlationData = {
            labels: ['DST Index', 'Bx GSE', 'By GSE', 'Bz GSE', 'Solar Wind Speed', 'Density', 'Sunspot Number'],
            data: [
                [1.00, -0.65, 0.12, -0.78, -0.56, -0.32, -0.45], // DST Index
                [-0.65, 1.00, -0.08, 0.42, 0.38, 0.25, 0.30],    // Bx GSE
                [0.12, -0.08, 1.00, -0.15, 0.05, 0.10, 0.18],    // By GSE
                [-0.78, 0.42, -0.15, 1.00, 0.62, 0.40, 0.52],    // Bz GSE
                [-0.56, 0.38, 0.05, 0.62, 1.00, 0.70, 0.48],     // Solar Wind Speed
                [-0.32, 0.25, 0.10, 0.40, 0.70, 1.00, 0.35],     // Density
                [-0.45, 0.30, 0.18, 0.52, 0.48, 0.35, 1.00]      // Sunspot Number
            ]
        };

        // Function to display correlation heatmap
        function showCorrelationHeatmap() {
            // Destroy existing chart if it exists
            if (dataChart) {
                dataChart.destroy();
            }
            
            // Create a modal dialog for the correlation heatmap
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            
            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content';
            
            // Add close button
            const closeBtn = document.createElement('span');
            closeBtn.className = 'close-btn';
            closeBtn.innerHTML = '&times;';
            closeBtn.onclick = function() {
                document.body.removeChild(modal);
                updateChart(); // Restore the original chart
            };
            
            // Add title
            const title = document.createElement('h2');
            title.textContent = 'Correlation Analysis';
            title.style.marginBottom = '20px';
            
            // Add description
            const description = document.createElement('p');
            description.textContent = 'This heatmap shows the correlation coefficients between different solar parameters. Values closer to 1 indicate strong positive correlation, values closer to -1 indicate strong negative correlation, and values near 0 indicate little to no correlation.';
            description.style.marginBottom = '20px';
            
            // Create canvas for the heatmap
            const canvas = document.createElement('canvas');
            canvas.id = 'correlationChart';
            canvas.style.width = '100%';
            canvas.style.height = '400px';
            
            // Append elements to modal
            modalContent.appendChild(closeBtn);
            modalContent.appendChild(title);
            modalContent.appendChild(description);
            modalContent.appendChild(canvas);
            modal.appendChild(modalContent);
            
            // Add modal to body
            document.body.appendChild(modal);
            
            // Create the correlation heatmap
            const ctx = document.getElementById('correlationChart').getContext('2d');
            
            // Generate background colors based on correlation values
            const backgroundColors = correlationData.data.map(row => 
                row.map(value => {
                    // Red for negative correlations, blue for positive
                    if (value < 0) {
                        const intensity = Math.abs(value);
                        return `rgba(255, 99, 132, ${intensity})`;
                    } else {
                        return `rgba(54, 162, 235, ${value})`;
                    }
                })
            );
            
            // Create a table for the correlation matrix
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            table.style.marginTop = '20px';
            table.style.marginBottom = '20px';
            
            // Create header row
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            // Empty cell for top-left corner
            const cornerCell = document.createElement('th');
            cornerCell.style.border = '1px solid #ddd';
            cornerCell.style.padding = '8px';
            cornerCell.style.backgroundColor = '#f2f2f2';
            headerRow.appendChild(cornerCell);
            
            // Add column headers
            correlationData.labels.forEach(label => {
                const th = document.createElement('th');
                th.textContent = label;
                th.style.border = '1px solid #ddd';
                th.style.padding = '8px';
                th.style.backgroundColor = '#f2f2f2';
                th.style.fontWeight = 'bold';
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Create table body
            const tbody = document.createElement('tbody');
            
            // Add data rows
            correlationData.data.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                
                // Add row header
                const rowHeader = document.createElement('th');
                rowHeader.textContent = correlationData.labels[rowIndex];
                rowHeader.style.border = '1px solid #ddd';
                rowHeader.style.padding = '8px';
                rowHeader.style.backgroundColor = '#f2f2f2';
                rowHeader.style.fontWeight = 'bold';
                rowHeader.style.textAlign = 'left';
                tr.appendChild(rowHeader);
                
                // Add data cells
                row.forEach(value => {
                    const td = document.createElement('td');
                    td.textContent = value.toFixed(2);
                    td.style.border = '1px solid #ddd';
                    td.style.padding = '8px';
                    td.style.textAlign = 'center';
                    
                    // Color coding based on correlation value
                    if (value === 1) {
                        // Perfect correlation (diagonal)
                        td.style.backgroundColor = 'rgba(54, 162, 235, 1)';
                        td.style.color = 'white';
                    } else if (value > 0) {
                        // Positive correlation
                        td.style.backgroundColor = `rgba(54, 162, 235, ${value})`;
                    } else if (value < 0) {
                        // Negative correlation
                        td.style.backgroundColor = `rgba(255, 99, 132, ${Math.abs(value)})`;
                    } else {
                        // Zero correlation
                        td.style.backgroundColor = '#f9f9f9';
                    }
                    
                    tr.appendChild(td);
                });
                
                tbody.appendChild(tr);
            });
            
            table.appendChild(tbody);
            
            // Replace canvas with table
            modalContent.removeChild(canvas);
            modalContent.appendChild(table);
            
            // Add color legend
            const legendDiv = document.createElement('div');
            legendDiv.style.display = 'flex';
            legendDiv.style.justifyContent = 'center';
            legendDiv.style.alignItems = 'center';
            legendDiv.style.marginTop = '20px';
            
            const negativeLabel = document.createElement('span');
            negativeLabel.textContent = 'Strong Negative';
            negativeLabel.style.marginRight = '5px';
            
            const gradientDiv = document.createElement('div');
            gradientDiv.style.width = '300px';
            gradientDiv.style.height = '20px';
            gradientDiv.style.background = 'linear-gradient(to right, rgba(255, 99, 132, 1), rgba(255, 255, 255, 1), rgba(54, 162, 235, 1))';
            gradientDiv.style.margin = '0 10px';
            
            const positiveLabel = document.createElement('span');
            positiveLabel.textContent = 'Strong Positive';
            positiveLabel.style.marginLeft = '5px';
            
            legendDiv.appendChild(negativeLabel);
            legendDiv.appendChild(gradientDiv);
            legendDiv.appendChild(positiveLabel);
            
            modalContent.appendChild(legendDiv);
        }

        // Additional visualization buttons
        document.getElementById('correlationBtn').addEventListener('click', showCorrelationHeatmap);
        
        // Sample storm distribution data
        const stormDistributionData = {
            labels: ['Minor', 'Moderate', 'Strong', 'Severe', 'Extreme'],
            datasets: [{
                label: 'Number of Storms',
                data: [45, 27, 12, 5, 2],
                backgroundColor: [
                    'rgba(75, 192, 192, 0.7)',  // Minor - Teal
                    'rgba(54, 162, 235, 0.7)',  // Moderate - Blue
                    'rgba(255, 206, 86, 0.7)',  // Strong - Yellow
                    'rgba(255, 159, 64, 0.7)',  // Severe - Orange
                    'rgba(255, 99, 132, 0.7)'   // Extreme - Red
                ],
                borderColor: [
                    'rgba(75, 192, 192, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(255, 99, 132, 1)'
                ],
                borderWidth: 1
            }]
        };

        // Function to display storm distribution
        function showStormDistribution() {
            // Destroy existing chart if it exists
            if (dataChart) {
                dataChart.destroy();
            }
            
            // Create a modal dialog for the storm distribution
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            
            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content';
            
            // Add close button
            const closeBtn = document.createElement('span');
            closeBtn.className = 'close-btn';
            closeBtn.innerHTML = '&times;';
            closeBtn.onclick = function() {
                document.body.removeChild(modal);
                updateChart(); // Restore the original chart
            };
            
            // Add title
            const title = document.createElement('h2');
            title.textContent = 'Solar Storm Distribution';
            title.style.marginBottom = '20px';
            
            // Add description
            const description = document.createElement('p');
            description.textContent = 'This chart shows the distribution of solar storms by intensity category over the past solar cycle. Storm categories are based on the NOAA Space Weather Scale for geomagnetic storms.';
            description.style.marginBottom = '20px';
            
            // Create canvas for the chart
            const canvas = document.createElement('canvas');
            canvas.id = 'stormDistributionChart';
            canvas.style.width = '100%';
            canvas.style.height = '400px';
            
            // Append elements to modal
            modalContent.appendChild(closeBtn);
            modalContent.appendChild(title);
            modalContent.appendChild(description);
            modalContent.appendChild(canvas);
            modal.appendChild(modalContent);
            
            // Add modal to body
            document.body.appendChild(modal);
            
            // Create the storm distribution chart
            const ctx = document.getElementById('stormDistributionChart').getContext('2d');
            
            // Create the chart
            const distributionChart = new Chart(ctx, {
                type: 'bar',
                data: stormDistributionData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Number of storms: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Storms'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Storm Intensity Category'
                            }
                        }
                    }
                }
            });
            
            // Add a table with storm category descriptions
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            table.style.marginTop = '30px';
            
            // Create table header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            const categoryHeader = document.createElement('th');
            categoryHeader.textContent = 'Category';
            categoryHeader.style.border = '1px solid #ddd';
            categoryHeader.style.padding = '8px';
            categoryHeader.style.backgroundColor = '#f2f2f2';
            
            const descriptionHeader = document.createElement('th');
            descriptionHeader.textContent = 'Description';
            descriptionHeader.style.border = '1px solid #ddd';
            descriptionHeader.style.padding = '8px';
            descriptionHeader.style.backgroundColor = '#f2f2f2';
            
            const effectsHeader = document.createElement('th');
            effectsHeader.textContent = 'Potential Effects';
            effectsHeader.style.border = '1px solid #ddd';
            effectsHeader.style.padding = '8px';
            effectsHeader.style.backgroundColor = '#f2f2f2';
            
            headerRow.appendChild(categoryHeader);
            headerRow.appendChild(descriptionHeader);
            headerRow.appendChild(effectsHeader);
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Create table body
            const tbody = document.createElement('tbody');
            
            // Storm category data
            const stormCategories = [
                {
                    category: 'Minor (G1)',
                    description: 'Kp = 5',
                    effects: 'Weak power grid fluctuations, minor impact on satellite operations, aurora visible at high latitudes.'
                },
                {
                    category: 'Moderate (G2)',
                    description: 'Kp = 6',
                    effects: 'High-latitude power systems may experience voltage alarms, long-duration storms may cause transformer damage.'
                },
                {
                    category: 'Strong (G3)',
                    description: 'Kp = 7',
                    effects: 'Voltage corrections may be required, false alarms triggered on protection devices, aurora visible at mid-latitudes.'
                },
                {
                    category: 'Severe (G4)',
                    description: 'Kp = 8',
                    effects: 'Possible widespread voltage control problems, some grid systems may experience complete collapse or blackouts.'
                },
                {
                    category: 'Extreme (G5)',
                    description: 'Kp = 9',
                    effects: 'Widespread voltage control problems and protective system problems, grid systems may experience complete collapse or blackouts.'
                }
            ];
            
            // Add rows to the table
            stormCategories.forEach((category, index) => {
                const row = document.createElement('tr');
                
                const categoryCell = document.createElement('td');
                categoryCell.textContent = category.category;
                categoryCell.style.border = '1px solid #ddd';
                categoryCell.style.padding = '8px';
                categoryCell.style.backgroundColor = stormDistributionData.datasets[0].backgroundColor[index];
                categoryCell.style.color = '#fff';
                categoryCell.style.fontWeight = 'bold';
                
                const descriptionCell = document.createElement('td');
                descriptionCell.textContent = category.description;
                descriptionCell.style.border = '1px solid #ddd';
                descriptionCell.style.padding = '8px';
                
                const effectsCell = document.createElement('td');
                effectsCell.textContent = category.effects;
                effectsCell.style.border = '1px solid #ddd';
                effectsCell.style.padding = '8px';
                
                row.appendChild(categoryCell);
                row.appendChild(descriptionCell);
                row.appendChild(effectsCell);
                tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            modalContent.appendChild(table);
            
            // Add yearly distribution chart
            const yearlyTitle = document.createElement('h3');
            yearlyTitle.textContent = 'Yearly Storm Distribution';
            yearlyTitle.style.marginTop = '30px';
            yearlyTitle.style.marginBottom = '20px';
            modalContent.appendChild(yearlyTitle);
            
            const yearlyDescription = document.createElement('p');
            yearlyDescription.textContent = 'This chart shows the distribution of solar storms by year, demonstrating the cyclical nature of solar activity.';
            yearlyDescription.style.marginBottom = '20px';
            modalContent.appendChild(yearlyDescription);
            
            const yearlyCanvas = document.createElement('canvas');
            yearlyCanvas.id = 'yearlyDistributionChart';
            yearlyCanvas.style.width = '100%';
            yearlyCanvas.style.height = '300px';
            modalContent.appendChild(yearlyCanvas);
            
            // Create the yearly distribution chart
            const yearlyCtx = document.getElementById('yearlyDistributionChart').getContext('2d');
            
            // Sample yearly data
            const yearlyData = {
                labels: ['2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024'],
                datasets: [
                    {
                        label: 'Minor',
                        data: [3, 5, 4, 2, 3, 4, 6, 7, 8, 3],
                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Moderate',
                        data: [2, 3, 2, 1, 2, 3, 4, 5, 3, 2],
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Strong',
                        data: [1, 2, 1, 0, 1, 1, 2, 2, 1, 1],
                        backgroundColor: 'rgba(255, 206, 86, 0.7)',
                        borderColor: 'rgba(255, 206, 86, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Severe',
                        data: [0, 1, 0, 0, 0, 1, 1, 1, 1, 0],
                        backgroundColor: 'rgba(255, 159, 64, 0.7)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Extreme',
                        data: [0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }
                ]
            };
            
            const yearlyChart = new Chart(yearlyCtx, {
                type: 'bar',
                data: yearlyData,
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        },
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Year'
                            }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Number of Storms'
                            }
                        }
                    }
                }
            });
            
            // Add percentage distribution pie chart
            const pieTitle = document.createElement('h3');
            pieTitle.textContent = 'Storm Category Distribution (%)';
            pieTitle.style.marginTop = '30px';
            pieTitle.style.marginBottom = '20px';
            modalContent.appendChild(pieTitle);
            
            const pieDescription = document.createElement('p');
            pieDescription.textContent = 'This chart shows the percentage breakdown of solar storms by intensity category.';
            pieDescription.style.marginBottom = '20px';
            modalContent.appendChild(pieDescription);
            
            // Create a container for the pie chart (to control its size)
            const pieContainer = document.createElement('div');
            pieContainer.style.width = '60%';
            pieContainer.style.margin = '0 auto';
            pieContainer.style.marginBottom = '30px';
            
            const pieCanvas = document.createElement('canvas');
            pieCanvas.id = 'pieDistributionChart';
            pieCanvas.style.width = '100%';
            pieCanvas.style.height = '300px';
            pieContainer.appendChild(pieCanvas);
            modalContent.appendChild(pieContainer);
            
            // Create the pie chart
            const pieCtx = document.getElementById('pieDistributionChart').getContext('2d');
            
            // Calculate total for percentages
            const total = stormDistributionData.datasets[0].data.reduce((sum, value) => sum + value, 0);
            
            const pieChart = new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: stormDistributionData.labels,
                    datasets: [{
                        data: stormDistributionData.datasets[0].data,
                        backgroundColor: stormDistributionData.datasets[0].backgroundColor,
                        borderColor: stormDistributionData.datasets[0].borderColor,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.getElementById('distributionBtn').addEventListener('click', showStormDistribution);
        
        // Sample satellite data
        const satelliteData = {
            // Satellite positions in Earth-centered coordinates (x, y, z in Earth radii)
            satellites: [
                { id: 'GOES-16', name: 'GOES-16 (GOES-East)', type: 'Weather', 
                  position: { x: 6.6, y: 0, z: 0 }, 
                  description: 'Geostationary Operational Environmental Satellite, provides continuous monitoring of Earth\'s Western Hemisphere.' },
                { id: 'GOES-18', name: 'GOES-18 (GOES-West)', type: 'Weather', 
                  position: { x: -6.6, y: 0, z: 0 }, 
                  description: 'Geostationary Operational Environmental Satellite, provides continuous monitoring of Earth\'s Western Hemisphere.' },
                { id: 'SDO', name: 'Solar Dynamics Observatory', type: 'Solar', 
                  position: { x: 0, y: 6.6, z: 0 }, 
                  description: 'Observes the Sun to understand solar variations that influence life on Earth and humanity\'s technological systems.' },
                { id: 'SOHO', name: 'Solar and Heliospheric Observatory', type: 'Solar', 
                  position: { x: 0, y: -6.6, z: 0 }, 
                  description: 'Studies the Sun from its deep core to the outer corona and the solar wind.' },
                { id: 'DSCOVR', name: 'Deep Space Climate Observatory', type: 'Space Weather', 
                  position: { x: 0, y: 0, z: 6.6 }, 
                  description: 'Monitors the solar wind in real time, providing warnings of geomagnetic storms.' },
                { id: 'ACE', name: 'Advanced Composition Explorer', type: 'Space Weather', 
                  position: { x: 0, y: 0, z: -6.6 }, 
                  description: 'Studies particles of solar, interplanetary, interstellar, and galactic origins.' },
                { id: 'STEREO-A', name: 'Solar Terrestrial Relations Observatory Ahead', type: 'Solar', 
                  position: { x: 4.5, y: 4.5, z: 0 }, 
                  description: 'Provides stereoscopic measurements of the Sun and solar phenomena.' },
                { id: 'WIND', name: 'Wind Spacecraft', type: 'Space Weather', 
                  position: { x: -4.5, y: 4.5, z: 0 }, 
                  description: 'Measures solar wind parameters to understand the Sun-Earth connection.' },
                { id: 'THEMIS-B', name: 'Time History of Events and Macroscale Interactions B', type: 'Magnetosphere', 
                  position: { x: 4.5, y: -4.5, z: 0 }, 
                  description: 'Studies magnetospheric substorms that release energy from the Earth\'s magnetotail.' },
                { id: 'THEMIS-C', name: 'Time History of Events and Macroscale Interactions C', type: 'Magnetosphere', 
                  position: { x: -4.5, y: -4.5, z: 0 }, 
                  description: 'Studies magnetospheric substorms that release energy from the Earth\'s magnetotail.' },
                { id: 'MMS-1', name: 'Magnetospheric Multiscale Mission 1', type: 'Magnetosphere', 
                  position: { x: 3.5, y: 0, z: 3.5 }, 
                  description: 'Studies the microphysics of magnetic reconnection, energetic particle acceleration, and turbulence.' },
                { id: 'POLAR', name: 'Polar Spacecraft', type: 'Magnetosphere', 
                  position: { x: -3.5, y: 0, z: 3.5 }, 
                  description: 'Studies the entry of plasma into the Earth\'s magnetosphere and the geomagnetic tail.' }
            ],
            // Sample solar event data
            solarEvent: {
                time: '2024-05-15T12:30:00Z',
                type: 'Coronal Mass Ejection (CME)',
                speed: 1250, // km/s
                direction: { x: 0.8, y: 0.1, z: 0.1 },
                arrivalTime: '2024-05-17T06:45:00Z',
                intensity: 'Strong (G3)'
            }
        };

        // Function to display satellite positions
        function showSatellitePositions() {
            // Destroy existing chart if it exists
            if (dataChart) {
                dataChart.destroy();
            }
            
            // Create a modal dialog for the satellite positions
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            
            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content';
            modalContent.style.width = '90%';
            modalContent.style.maxWidth = '1200px';
            
            // Add close button
            const closeBtn = document.createElement('span');
            closeBtn.className = 'close-btn';
            closeBtn.innerHTML = '&times;';
            closeBtn.onclick = function() {
                document.body.removeChild(modal);
                updateChart(); // Restore the original chart
            };
            
            // Add title
            const title = document.createElement('h2');
            title.textContent = 'Satellite Positions During Solar Events';
            title.style.marginBottom = '20px';
            
            // Add description
            const description = document.createElement('p');
            description.innerHTML = `This visualization shows the positions of various satellites monitoring space weather and solar activity during a <strong>${satelliteData.solarEvent.type}</strong> event detected on <strong>${new Date(satelliteData.solarEvent.time).toLocaleString()}</strong>. The event had an estimated speed of <strong>${satelliteData.solarEvent.speed} km/s</strong> and resulted in a <strong>${satelliteData.solarEvent.intensity}</strong> geomagnetic storm.`;
            description.style.marginBottom = '20px';
            
            // Create container for the 3D visualization and satellite info
            const visualizationContainer = document.createElement('div');
            visualizationContainer.style.display = 'flex';
            visualizationContainer.style.flexWrap = 'wrap';
            visualizationContainer.style.gap = '20px';
            
            // Create the 3D visualization container
            const canvasContainer = document.createElement('div');
            canvasContainer.style.flex = '1';
            canvasContainer.style.minWidth = '500px';
            canvasContainer.style.height = '500px';
            canvasContainer.style.position = 'relative';
            canvasContainer.style.border = '1px solid #ddd';
            canvasContainer.style.borderRadius = '5px';
            canvasContainer.style.backgroundColor = '#f8f9fa';
            
            // Create canvas for the 3D visualization
            const canvas = document.createElement('canvas');
            canvas.id = 'satelliteCanvas';
            canvas.style.width = '100%';
            canvas.style.height = '100%';
            canvasContainer.appendChild(canvas);
            
            // Create the satellite information panel
            const infoPanel = document.createElement('div');
            infoPanel.style.flex = '1';
            infoPanel.style.minWidth = '300px';
            infoPanel.style.maxHeight = '500px';
            infoPanel.style.overflowY = 'auto';
            infoPanel.style.padding = '15px';
            infoPanel.style.border = '1px solid #ddd';
            infoPanel.style.borderRadius = '5px';
            
            // Add satellite information header
            const infoHeader = document.createElement('h3');
            infoHeader.textContent = 'Satellite Information';
            infoHeader.style.marginTop = '0';
            infoPanel.appendChild(infoHeader);
            
            // Create filter controls
            const filterContainer = document.createElement('div');
            filterContainer.style.marginBottom = '15px';
            
            const filterLabel = document.createElement('label');
            filterLabel.textContent = 'Filter by type: ';
            filterLabel.style.marginRight = '10px';
            filterContainer.appendChild(filterLabel);
            
            const filterSelect = document.createElement('select');
            filterSelect.id = 'satelliteTypeFilter';
            filterSelect.style.padding = '5px';
            filterSelect.style.borderRadius = '4px';
            
            // Get unique satellite types
            const satelliteTypes = ['All', ...new Set(satelliteData.satellites.map(sat => sat.type))];
            
            // Add options to select
            satelliteTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                filterSelect.appendChild(option);
            });
            
            filterContainer.appendChild(filterSelect);
            infoPanel.appendChild(filterContainer);
            
            // Create satellite list
            const satelliteList = document.createElement('div');
            satelliteList.id = 'satelliteList';
            infoPanel.appendChild(satelliteList);
            
            // Add containers to the visualization container
            visualizationContainer.appendChild(canvasContainer);
            visualizationContainer.appendChild(infoPanel);
            
            // Create event timeline section
            const timelineSection = document.createElement('div');
            timelineSection.style.marginTop = '30px';
            timelineSection.style.width = '100%';
            
            const timelineTitle = document.createElement('h3');
            timelineTitle.textContent = 'Solar Event Timeline';
            timelineSection.appendChild(timelineTitle);
            
            const timelineDescription = document.createElement('p');
            timelineDescription.textContent = 'This timeline shows the progression of the solar event and its effects on Earth and satellites.';
            timelineSection.appendChild(timelineDescription);
            
            // Create timeline container
            const timelineContainer = document.createElement('div');
            timelineContainer.style.position = 'relative';
            timelineContainer.style.margin = '40px 0';
            timelineContainer.style.height = '100px';
            
            // Create timeline line
            const timelineLine = document.createElement('div');
            timelineLine.style.position = 'absolute';
            timelineLine.style.top = '50%';
            timelineLine.style.left = '0';
            timelineLine.style.width = '100%';
            timelineLine.style.height = '4px';
            timelineLine.style.backgroundColor = '#ddd';
            timelineLine.style.transform = 'translateY(-50%)';
            timelineContainer.appendChild(timelineLine);
            
            // Timeline events
            const events = [
                { time: satelliteData.solarEvent.time, label: 'CME Detected', description: 'Coronal Mass Ejection detected by SOHO and SDO' },
                { time: '2024-05-16T03:15:00Z', label: 'CME in Transit', description: 'CME traveling through interplanetary space at 1250 km/s' },
                { time: '2024-05-16T18:30:00Z', label: 'Shock Arrival at L1', description: 'Shock detected by DSCOVR at L1 point' },
                { time: satelliteData.solarEvent.arrivalTime, label: 'Geomagnetic Storm Begins', description: 'G3 (Strong) geomagnetic storm begins on Earth' },
                { time: '2024-05-18T12:00:00Z', label: 'Storm Recovery', description: 'Geomagnetic conditions begin to recover' }
            ];
            
            // Add events to timeline
            events.forEach((event, index) => {
                const position = (index / (events.length - 1)) * 100;
                
                // Create event marker
                const marker = document.createElement('div');
                marker.style.position = 'absolute';
                marker.style.top = '50%';
                marker.style.left = `${position}%`;
                marker.style.width = '16px';
                marker.style.height = '16px';
                marker.style.borderRadius = '50%';
                marker.style.backgroundColor = '#3498db';
                marker.style.transform = 'translate(-50%, -50%)';
                marker.style.zIndex = '2';
                marker.style.cursor = 'pointer';
                
                // Create event label
                const label = document.createElement('div');
                label.style.position = 'absolute';
                label.style.top = index % 2 === 0 ? '0' : '70%';
                label.style.left = `${position}%`;
                label.style.transform = 'translateX(-50%)';
                label.style.textAlign = 'center';
                label.style.fontWeight = 'bold';
                label.style.fontSize = '14px';
                label.textContent = event.label;
                
                // Create event time
                const time = document.createElement('div');
                time.style.position = 'absolute';
                time.style.top = index % 2 === 0 ? '20px' : '90%';
                time.style.left = `${position}%`;
                time.style.transform = 'translateX(-50%)';
                time.style.textAlign = 'center';
                time.style.fontSize = '12px';
                time.style.color = '#666';
                time.textContent = new Date(event.time).toLocaleString();
                
                // Add tooltip functionality
                marker.title = event.description;
                
                // Add elements to timeline
                timelineContainer.appendChild(marker);
                timelineContainer.appendChild(label);
                timelineContainer.appendChild(time);
            });
            
            timelineSection.appendChild(timelineContainer);
            
            // Append all elements to modal content
            modalContent.appendChild(closeBtn);
            modalContent.appendChild(title);
            modalContent.appendChild(description);
            modalContent.appendChild(visualizationContainer);
            modalContent.appendChild(timelineSection);
            modal.appendChild(modalContent);
            
            // Add modal to body
            document.body.appendChild(modal);
            
            // Function to render satellite list
            function renderSatelliteList(filter = 'All') {
                const listContainer = document.getElementById('satelliteList');
                listContainer.innerHTML = '';
                
                // Filter satellites
                const filteredSatellites = filter === 'All' 
                    ? satelliteData.satellites 
                    : satelliteData.satellites.filter(sat => sat.type === filter);
                
                // Create satellite items
                filteredSatellites.forEach(satellite => {
                    const satItem = document.createElement('div');
                    satItem.className = 'satellite-item';
                    satItem.style.padding = '10px';
                    satItem.style.marginBottom = '10px';
                    satItem.style.border = '1px solid #ddd';
                    satItem.style.borderRadius = '4px';
                    satItem.style.cursor = 'pointer';
                    
                    // Highlight when hovering
                    satItem.onmouseover = function() {
                        this.style.backgroundColor = '#f0f0f0';
                        highlightSatellite(satellite.id);
                    };
                    satItem.onmouseout = function() {
                        this.style.backgroundColor = '';
                        unhighlightSatellite();
                    };
                    
                    const satName = document.createElement('h4');
                    satName.textContent = satellite.name;
                    satName.style.margin = '0 0 5px 0';
                    
                    const satType = document.createElement('p');
                    satType.textContent = `Type: ${satellite.type}`;
                    satType.style.margin = '0 0 5px 0';
                    satType.style.fontSize = '14px';
                    
                    const satPosition = document.createElement('p');
                    satPosition.textContent = `Position: X=${satellite.position.x.toFixed(1)}, Y=${satellite.position.y.toFixed(1)}, Z=${satellite.position.z.toFixed(1)} Earth radii`;
                    satPosition.style.margin = '0 0 5px 0';
                    satPosition.style.fontSize = '14px';
                    
                    const satDesc = document.createElement('p');
                    satDesc.textContent = satellite.description;
                    satDesc.style.margin = '0';
                    satDesc.style.fontSize = '14px';
                    
                    satItem.appendChild(satName);
                    satItem.appendChild(satType);
                    satItem.appendChild(satPosition);
                    satItem.appendChild(satDesc);
                    
                    listContainer.appendChild(satItem);
                });
            }
            
            // Add filter change event
            document.getElementById('satelliteTypeFilter').addEventListener('change', function() {
                renderSatelliteList(this.value);
            });
            
            // Initialize the satellite list
            renderSatelliteList();
            
            // Create a simple 2D visualization of the satellites
            const ctx = document.getElementById('satelliteCanvas').getContext('2d');
            let highlightedSatellite = null;
            
            // Function to draw the visualization
            function drawVisualization() {
                const canvas = ctx.canvas;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Set canvas dimensions
                canvas.width = canvas.clientWidth;
                canvas.height = canvas.clientHeight;
                
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const scale = Math.min(canvas.width, canvas.height) / 20; // Scale factor
                
                // Draw coordinate system
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                
                // X-axis
                ctx.beginPath();
                ctx.moveTo(0, centerY);
                ctx.lineTo(canvas.width, centerY);
                ctx.stroke();
                
                // Y-axis
                ctx.beginPath();
                ctx.moveTo(centerX, 0);
                ctx.lineTo(centerX, canvas.height);
                ctx.stroke();
                
                // Draw Earth
                ctx.beginPath();
                ctx.arc(centerX, centerY, scale, 0, Math.PI * 2);
                ctx.fillStyle = '#3498db';
                ctx.fill();
                ctx.strokeStyle = '#2980b9';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Label Earth
                ctx.fillStyle = '#000';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Earth', centerX, centerY + scale + 20);
                
                // Draw Sun direction indicator
                const sunX = centerX - canvas.width * 0.4;
                const sunY = centerY;
                
                // Sun rays
                ctx.strokeStyle = '#f39c12';
                ctx.lineWidth = 2;
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2;
                    const rayLength = 15;
                    ctx.beginPath();
                    ctx.moveTo(sunX + Math.cos(angle) * 20, sunY + Math.sin(angle) * 20);
                    ctx.lineTo(sunX + Math.cos(angle) * (20 + rayLength), sunY + Math.sin(angle) * (20 + rayLength));
                    ctx.stroke();
                }
                
                // Sun
                ctx.beginPath();
                ctx.arc(sunX, sunY, 20, 0, Math.PI * 2);
                ctx.fillStyle = '#f1c40f';
                ctx.fill();
                
                // Label Sun
                ctx.fillStyle = '#000';
                ctx.fillText('Sun', sunX, sunY + 40);
                
                // Draw CME direction
                const cmeLength = canvas.width * 0.3;
                const cmeStartX = sunX + 20;
                const cmeStartY = sunY;
                const cmeEndX = cmeStartX + cmeLength * satelliteData.solarEvent.direction.x;
                const cmeEndY = cmeStartY + cmeLength * satelliteData.solarEvent.direction.y;
                
                // CME arrow
                ctx.beginPath();
                ctx.moveTo(cmeStartX, cmeStartY);
                ctx.lineTo(cmeEndX, cmeEndY);
                ctx.strokeStyle = 'rgba(231, 76, 60, 0.7)';
                ctx.lineWidth = 15;
                ctx.stroke();
                
                // Arrow head
                const headLength = 15;
                const angle = Math.atan2(cmeEndY - cmeStartY, cmeEndX - cmeStartX);
                ctx.beginPath();
                ctx.moveTo(cmeEndX, cmeEndY);
                ctx.lineTo(cmeEndX - headLength * Math.cos(angle - Math.PI / 6), cmeEndY - headLength * Math.sin(angle - Math.PI / 6));
                ctx.lineTo(cmeEndX - headLength * Math.cos(angle + Math.PI / 6), cmeEndY - headLength * Math.sin(angle + Math.PI / 6));
                ctx.closePath();
                ctx.fillStyle = 'rgba(231, 76, 60, 0.9)';
                ctx.fill();
                
                // Label CME
                ctx.fillStyle = '#c0392b';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('CME', cmeStartX + cmeLength * 0.5 * satelliteData.solarEvent.direction.x, 
                           cmeStartY + cmeLength * 0.5 * satelliteData.solarEvent.direction.y - 15);
                
                // Draw satellites
                satelliteData.satellites.forEach(satellite => {
                    const satX = centerX + satellite.position.x * scale;
                    const satY = centerY - satellite.position.y * scale; // Y is inverted in canvas
                    
                    // Determine satellite color based on type
                    let satColor;
                    switch(satellite.type) {
                        case 'Weather':
                            satColor = '#27ae60';
                            break;
                        case 'Solar':
                            satColor = '#e67e22';
                            break;
                        case 'Space Weather':
                            satColor = '#8e44ad';
                            break;
                        case 'Magnetosphere':
                            satColor = '#16a085';
                            break;
                        default:
                            satColor = '#7f8c8d';
                    }
                    
                    // Draw satellite orbit (simplified as a circle)
                    const orbitRadius = Math.sqrt(
                        Math.pow(satellite.position.x, 2) + 
                        Math.pow(satellite.position.y, 2)
                    ) * scale;
                    
                    if (orbitRadius > 0) {
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, orbitRadius, 0, Math.PI * 2);
                        ctx.strokeStyle = 'rgba(189, 195, 199, 0.3)';
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                    
                    // Draw satellite
                    ctx.beginPath();
                    const satRadius = highlightedSatellite === satellite.id ? 8 : 5;
                    ctx.arc(satX, satY, satRadius, 0, Math.PI * 2);
                    ctx.fillStyle = highlightedSatellite === satellite.id ? '#e74c3c' : satColor;
                    ctx.fill();
                    
                    // Draw satellite label if highlighted or if it's a major satellite
                    if (highlightedSatellite === satellite.id) {
                        ctx.fillStyle = '#000';
                        ctx.font = 'bold 12px Arial';
                        ctx.fillText(satellite.id, satX, satY - 15);
                    }
                });
                
                // Add legend
                const legendX = 20;
                let legendY = 20;
                const legendSpacing = 25;
                
                ctx.font = '14px Arial';
                ctx.textAlign = 'left';
                
                // Title
                ctx.fillStyle = '#000';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('Satellite Types:', legendX, legendY);
                legendY += legendSpacing;
                
                // Weather satellites
                ctx.beginPath();
                ctx.arc(legendX + 7, legendY - 5, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#27ae60';
                ctx.fill();
                ctx.fillStyle = '#000';
                ctx.font = '14px Arial';
                ctx.fillText('Weather', legendX + 20, legendY);
                legendY += legendSpacing;
                
                // Solar satellites
                ctx.beginPath();
                ctx.arc(legendX + 7, legendY - 5, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#e67e22';
                ctx.fill();
                ctx.fillStyle = '#000';
                ctx.fillText('Solar', legendX + 20, legendY);
                legendY += legendSpacing;
                
                // Space Weather satellites
                ctx.beginPath();
                ctx.arc(legendX + 7, legendY - 5, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#8e44ad';
                ctx.fill();
                ctx.fillStyle = '#000';
                ctx.fillText('Space Weather', legendX + 20, legendY);
                legendY += legendSpacing;
                
                // Magnetosphere satellites
                ctx.beginPath();
                ctx.arc(legendX + 7, legendY - 5, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#16a085';
                ctx.fill();
                ctx.fillStyle = '#000';
                ctx.fillText('Magnetosphere', legendX + 20, legendY);
            }
            
            // Function to highlight a satellite
            function highlightSatellite(satelliteId) {
                highlightedSatellite = satelliteId;
                drawVisualization();
            }
            
            // Function to remove highlight
            function unhighlightSatellite() {
                highlightedSatellite = null;
                drawVisualization();
            }
            
            // Initial draw
            drawVisualization();
            
            // Redraw on window resize
            window.addEventListener('resize', drawVisualization);
        }

        document.getElementById('satelliteBtn').addEventListener('click', showSatellitePositions);
    </script>
</body>
</html>